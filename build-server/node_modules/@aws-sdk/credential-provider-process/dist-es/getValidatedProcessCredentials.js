<<<<<<< HEAD
export const getValidatedProcessCredentials = (profileName, data, profiles) => {
=======
export const getValidatedProcessCredentials = (profileName, data) => {
>>>>>>> e6303e2b105fa1fb650176cad018dbce07875285
    if (data.Version !== 1) {
        throw Error(`Profile ${profileName} credential_process did not return Version 1.`);
    }
    if (data.AccessKeyId === undefined || data.SecretAccessKey === undefined) {
        throw Error(`Profile ${profileName} credential_process returned invalid credentials.`);
    }
    if (data.Expiration) {
        const currentTime = new Date();
        const expireTime = new Date(data.Expiration);
        if (expireTime < currentTime) {
            throw Error(`Profile ${profileName} credential_process returned expired credentials.`);
        }
    }
<<<<<<< HEAD
    let accountId = data.AccountId;
    if (!accountId && profiles?.[profileName]?.aws_account_id) {
        accountId = profiles[profileName].aws_account_id;
    }
=======
>>>>>>> e6303e2b105fa1fb650176cad018dbce07875285
    return {
        accessKeyId: data.AccessKeyId,
        secretAccessKey: data.SecretAccessKey,
        ...(data.SessionToken && { sessionToken: data.SessionToken }),
        ...(data.Expiration && { expiration: new Date(data.Expiration) }),
        ...(data.CredentialScope && { credentialScope: data.CredentialScope }),
<<<<<<< HEAD
        ...(accountId && { accountId }),
=======
>>>>>>> e6303e2b105fa1fb650176cad018dbce07875285
    };
};
